<!DOCTYPE html>
<html>
<head>
    <title>Design module</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- leaflet css -->
    <link rel="stylesheet" href="Content/Libs/leaflet.css" />
    <link rel="stylesheet" href="Content/Libs/leaflet.draw.css" />
    <link rel="stylesheet" href="Content/Libs/leaflet.contextmenu.css" />

    <link rel="stylesheet" href="Content/measures.css" />
    <link rel="stylesheet" href="Content/info.css" />
    <link rel="stylesheet" href="Content/legend.css" />
    <link rel="stylesheet" href="Content/domains.css" />
    <link rel="stylesheet" href="Content/currefdiff.css" />
    <link rel="stylesheet" href="Content/details.css" />
    <link rel="stylesheet" href="Content/kpis.css" />
    <link rel="stylesheet" href="Content/history.css" />
    <link rel="stylesheet" href="Content/projectdescription.css" />
    <link rel="stylesheet" href="Content/connectionstatus.css" />
    <link rel="stylesheet" href="Content/userMessages.css" />
    <link rel="stylesheet" href="Content/select.css" />
    <link rel="stylesheet" href="Content/timeslider.css" />
    <link rel="stylesheet" href="Content/windDirection.css" />
    <link rel="stylesheet" href="Content/files.css" />
    <link rel="stylesheet" href="Content/Graphs/TableGraphs.css" />

    <link rel="stylesheet" href="Content/map.css" />
    <link rel="stylesheet" href="Content/graphmanager.css" />
    <link rel="stylesheet" href="Content/syncmanager.css" />
    <link rel="stylesheet" href="Content/ModelControl.css" />
    
    <link rel="stylesheet" href="Content/default.css" />
    <link rel="stylesheet" href="Content/control.css" />
    <link rel="stylesheet" href="Content/dialog.css" />
    <link rel="stylesheet" href="Content/Libs/nouislider.css" />
    <link rel="stylesheet" href="Content/Libs/nouislider.pips.css" />
    <link rel="stylesheet" href="Content/Libs/nouislider.tooltips.css" />
    <link rel="stylesheet" href="Content/timeRangeSlider.css" />
    <link rel="stylesheet" href="Content/rangeSlider.css" />
    <link rel="stylesheet" href="Content/layermanager.css" />
    <link rel="stylesheet" href="Content/ScenarioControlsManager.css" />
    <link rel="stylesheet" href="Content/controlsControl.css" />
    <link rel="stylesheet" href="Content/ControlPropertiesDialog.css" />

    <link rel="apple-touch-icon" sizes="57x57" href="favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="shortcut icon" href="favicon/favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon/favicon.ico" type="image/x-icon">

</head>
<body>
    <!-- main map -->
    <div id="map"></div>
    <!-- static modal dialog place holder -->
    <div id="modalDialog" class="modalDialog"></div>
    <!-- connection status -->
    <div id="connectionStatus" class="connection-status connection-status-disconnected"></div>
    <!-- error messages -->
    <div id="userMessages" class="userMessages userMessages-hidden"><p id="userMessage">There is a message</p></div>

    <div id="messagesContainer" class="Messages messages-hidden">
        <span id="introText">Log:</span>
        <span id="deleteLogItems" onclick="deleteLogItems()">Delete all</span>
        <div id="messages"></div>
    </div>

    <!-- current-reference-difference selector -->
    <div id="currefdiff" class="currefdiff leaflet-container" title="Show the current version of the layer, reference version or difference between those"></div>
    <!-- time related elements-->
    <div id="timeslider" class="timeslider leaflet-container"></div>

    <div id="timestamp" class="timestamp leaflet-container timestamp-hidden" title="Shows the last known time the last added layer was based on"></div>
    <!-- load scripts -->
    <script>
        //DebugLogging = true;
        DebugLogging = false;
        //DebugLogging = (location.hostname === "localhost");
    </script>
    <!-- leaflet js -->
    <script src="Scripts/Libs/leaflet-src.js"></script>
    <!-- leaflet plugins -->
    <script src="Scripts/Libs/leaflet.draw-src.js"></script>
    <script src="Scripts/Libs/leaflet.contextmenu-src.js"></script>
    <script src="Scripts/Libs/L.Path.Drag-src.js"></script>
    <!-- leaflet map -->
    <script src="Scripts/map.js"></script>
    <!-- D3 -->
    <script src="Scripts/Libs/d3.js"></script>
    <script src="bower_components/d3-tip/index.js"></script>
    <script src="bower_components/chroma-js/chroma.js"></script>
    <!--<script src="bower_components/datalist-polyfill/datalist-polyfill.js"></script>-->
    <!-- other libs -->
    <script src="Scripts/Libs/FileSaver.js"></script>
    <!-- modal dialogs -->
    <script src="Scripts/Libs/nouislider.js"></script>
    <script src="Scripts/modaldialog.js"></script>
    <script src="Scripts/querydialog.js"></script>
    <script src="Scripts/formdialog.js"></script>
    <!--<script src="Scripts/warningDialog.js"></script>-->
    <!-- our code -->
    <script src="Scripts/datamanager.js"></script>
    <script src="Scripts/userMessages.js"></script>
    <script src="Scripts/select.js"></script>
    <script src="Scripts/measures.js"></script>
    <script src="Scripts/info.js"></script>
    <script src="Scripts/legend.js"></script>
    <script src="Scripts/domains.js"></script>
    <script src="Scripts/currefdiff.js"></script>
    <script src="Scripts/kpis.js"></script>
    <script src="Scripts/layers.js"></script>
    <script src="Scripts/details.js"></script>
    <script src="Scripts/history.js"></script>
    <script src="Scripts/projectdescription.js"></script>
    <script src="Scripts/timeslider.js"></script>
    <script src="Scripts/timeRangeSlider.js"></script>
    <script src="Scripts/rangeSlider.js"></script>
    <script src="Scripts/windDirection.js"></script>
    <script src="Scripts/webSocket.js"></script>
    <script src="Scripts/syncManager.js"></script>
    <script src="Scripts/UnitConverter.js"></script>
    <script src="Scripts/LayerManager.js"></script>
    <script src="Scripts/ModelControl.js"></script>
    <script src="Scripts/contextManager.js"></script>
    <script src="Scripts/ScenarioControlsManager.js"></script>
    <script src="Scripts/ControlsControl.js"></script>
    <script src="Scripts/files.js"></script>
    <script src="Scripts/ControlPropertiesDialog.js"></script>
    <!-- charts -->
    <script src="Scripts/graphManager.js"></script>
    <script src="Scripts/Graphs/bullet.js"></script>
    <script src="Scripts/Graphs/lineGraphs.js"></script>
    <script src="Scripts/Graphs/spiderChart.js"></script>
    <script src="Scripts/Graphs/BarChart.js"></script>
    <script src="Scripts/Graphs/tablegraphs.js"></script>
    <!-- modules -->
    <script src="Scripts/modules.js"></script>
    <!-- local scripts -->
    <script>
        wsp = 'https:' == document.location.protocol ? 'wss' : 'ws';
        // determine parameters and config
        var wsBaseURL = wsp + '://vps17642.public.cloudvps.com';
        //var wsBaseURL = wsp + '://vps54128.public.cloudvps.com';
        var session = getParameterByName('session', '');
        if (session == '') {
            //session = '6B84B11553BC4AA6B2B6A0759F6EB278'; // us_demo
            //session = '1234$undefined$57b4281041e330e716b22a74'; // default test session
            //session = '5721de16eae0e0c543f5234f$undefined$5714e0ccb83ce5066723bf41'; // ecodistrict warsaw
            //session = '57b428a6cef25a0a0d6681ac$undefined$57b4281041e330e716b22a74'; // ecodistrict antwerpen
            //session = '57b428a6cef25a0a0d6681ac$57f7721a38ddeb850af42d13$57b4281041e330e716b22a74'; // ecodistrict antwerpen alt 1
            //session = '4B95BE74F9A44DA0908A30B27C3E8C99'; // schiedam
            //session = '80BD7A788D6B40A4B3608AA95C26E68F'; // us_utrecht2017
            //session = '7435449FACA0425A88E072CAAC549E2B'; // us_ams_2017 Design
            //session = '7435449FACA0425A88E072CAAC549E2B-Design'; // us_ams_2017 Design
            //session = '7435449FACA0425A88E072CAAC549E2B-Debug-Design'; // us_ams_2017 Design debug version
            //session = '7435449FACA0425A88E072CAAC549E2B-Monitor'; // us_ams_2017 Monitor
            //session = '7435449FACA0425A88E072CAAC549E2B-Evaluate'; // us_ams_2017 Evaluate
            //session = '6DB7603E76694E2AA06F3F7F199EF973'; //us_ams_2017 Monitor
            //session = "sesmi${DE087221-5BB1-40AC-90A9-371CA39A399F}$testexpert"; // test expert user
            //session = "sesmi${d3d55d19-6568-4836-aa00-c2e88fd31fe9}$testuser"; // test guid from db
            //session = "sesmi${6051026f-3b94-4291-88fd-f4c26d5804dd}$testuser"; //test sensa-guid
            //session = "sesmi${9F180B74-FE6A-4D66-9736-F6C9C59E87DD}$fietsuser"; //sensor box
            //session = '9AADAB9F472D4E1EAA1DE7CE202780AB'; // response production
            //session = '5904DD8ACDD54E15A3A8AA8EA55C0C64'; // response test
            //session = '17C9E2AE2A6341AD92EA00E9D3BDC2BB'; //  response production DynamicPlumes
            //session = '15B0B9AD002343459B36471524BC0FDD'; // karlsruhe
            //session = 'OmniTransConnectorA642109';
            //session = 'EarlyWarning'; //  early warning (Jan Duyzer)
            //session = '7F9B10D93ABB493F876E3D035D55269F'; // Santos (E-Bus)
            //session = '3F5435CDD5A7490DAD3A173B4548A06E'; // New Dehli
            //session = "sesmi${103ae874-daaf-40f4-8b89-a9f8fddd9644}$fietsuser"; // ensel fiets utrecht-nijmegen
            //session = "sesmi${e4fd1734-ce20-439f-bd60-b0a29fb744b6}$fietsuser"; // ensel fiets eindhoven, representatief
            //session = 'B9E738A9BCD94D3AABB051924A0E8F12'; //Hans test database design
            //session = 'C298FCB67045468CBCDA6CC2C415C041'; //Hans test database monitor
            //session = '67AC10799B044C01B552DB44283990D7'; //Hans test database evaluate
            //session = 'TestRKDesign'; //Ralph test database design
            //session = 'TestRKMonitor'; //Ralph test database monitor
            //session = 'TestRKEvaluate'; //Ralph test database evaluate
            //session = 'HenkTest';
            //session = 'D937BA6603B64147BDA2C8CFED9D973F'; //app-usmodel01 AMS
            //session = 'testhans'; // test publisher
            //session = '1234$undefined$1234';
            //session = '5b7fc843820bed04cf284953$undefined$5b7fc800820bed04cf284952';
            //session = '5a6f19f07077d2096a218483$undefined$5a6f19f07077d2096a218483';
            //session = 'kiel2018';
            //session = 'kielDesign';
            //session = 'weesperstraat';
            //session = 'ExpoSenseTest';
            //session = 'kielmicro';
        }
        var clientType = getParameterByName('clientType', '');
        var sessionDescription = getParameterByName('sessionDescription', 'NOT connected to an active session');
        var scenario = '';
        var userid = '';
        // split session in session id/scenario id/user id
        var sessionParts = session.split('$');
        if (sessionParts.length > 1) {
            session = sessionParts[0];
            if (sessionParts.length > 2) {
                scenario = sessionParts[1];
                userid = sessionParts[2];
            }
            else
                userid = sessionParts[1];
        }

        DataManager.sessionInfo = {
            session: session,
            scenario: scenario,
            userid: userid,
            description: sessionDescription,
            referenceScenario: null
        };
        // Mobile
        if (window.innerWidth < 500) {
            document.body.setAttribute("id", "phone");
        } else {
            document.body.removeAttribute("id");
        }



        // top-right


        // domains
        var domainsControl = L.control.domains({});
        map.addControl(domainsControl);

        DataManager.detailsInfo = {
            elementWidth: 140,
            chartWidth: 134, chartHeight: 100,
            layerWidth: 134, layerHeight: 140,
            padding: 2,
            border: 1,
            graphMargin: 5
        }

        if (window.innerWidth < 500) {
            DataManager.detailsInfo.chartWidth = 20;
            DataManager.detailsInfo.chartHeight = 20;
        }

        // details
        var detailsControl = L.control.details(DataManager.detailsInfo);
        map.addControl(detailsControl);
        
        
        //history
        var historyControl = L.control.history(baseLayers); // todo (NK): why pass baseLayers as options?
        map.addControl(historyControl);
        map.removeControl(historyControl);
        DataManager.HistoryControl = historyControl;

        //presenter/viewer
        var presenterViewerControl = L.control.PresenterViewer();
        map.addControl(presenterViewerControl);
        map.removeControl(presenterViewerControl);
        DataManager.presenterViewerControl = presenterViewerControl;


        // top-left

        //controls
        DataManager.controlsControl = L.control.ControlsControl();
        //map.addControl(controlsControl);

        DataManager.overviewControl = L.control.OverviewControl();
        //map.addControl(overviewControl);

        //measures
        var measuresControl = L.control.measures([], historyControl);
        map.addControl(measuresControl);
        map.removeControl(measuresControl);
        measuresControl.setSelectCategories([]);

        DataManager.wind = L.control.arrow();//L.control.wind({});
        //map.addControl(DataManager.wind);

        //timeRangeSlider
        //DataManager.timeRangeSlider = new L.Control.TimeRangeSlider();
        //map.addControl(DataManager.timeRangeSlider);

        // test vertical slider
        //DataManager.timeRangeSliderV = new L.Control.TimeRangeSlider({ orientation: 'vertical' });
        //map.addControl(DataManager.timeRangeSliderV);

        // bottom-right (reverse order)

        // todo: scaling factor of domain (0.5 = 1.25 years (1 jan 2015 till now)/0.5 = 2.5 years; 500 = 2 years*365 day*24 hours*4 kwarters/35 visible max
        var timesliderControl = L.control.timeslider(timeslider);
        map.addControl(timesliderControl);
        timesliderControl._collapse();
        L.Control.InfoTexts['leaflet-control-timeslider'] = { active: false };
        map.removeControl(timesliderControl);


        DataManager.modelControl = L.control.ModelControl();
        map.addControl(DataManager.modelControl);
        map.removeControl(DataManager.modelControl);
        
        // current-reference-difference control
        var crd = L.control.crd({ parent: currefdiff });
        map.addControl(crd);

        detailsControl.setCRD(crd);

        // bottom-left (reverse order)

        // info
        /*
        var infoControl = L.control.info();
        map.addControl(infoControl);
        */

        // legend
        var legendControl = L.control.legend;
        map.addControl(legendControl);

        // files
        var filesControl = L.control.files();
        DataManager.filesControl = filesControl;

        // other

        // project description
        var projectDescription = L.control.projectDescription;
        projectDescription.options.description = sessionDescription;
        map.addControl(projectDescription);

        GraphManager.Initialize();

        map.addEventListener('overlayadd',
            function (e) {
                if (e.layer.basicLayer && e.layer.basicID)
                    DataManager.activeBasicLayers[e.layer.basicID] = e.layer.basicID;
            });

        map.addEventListener('overlayremove',
            function (e) {
                if (e.layer.basicLayer && e.layer.basicID)
                    delete DataManager.activeBasicLayers[e.layer.basicID];
            });

        // test graph
        /*
        testGraph = {};
        testGraph.id = 'tg';
        testGraph.name = 'tg name';
        testGraph.type = 'table';
        testGraph.data = { header: { a: 'Option', b: 'Value' }, data: [{ a: 'Heel belangrijke waarde', b: 2.4 }, { a: 'Ook heel belangrijk', b: '7.456 MW' }] };

        GraphManager.MakeGraph(testGraph);
        testGraph.container.graph.ShowGraph();
        */

        // link up connection control
        var connectionStatus = document.getElementById('connectionStatus');
        connectionStatus.classList.add('connection-status-disconnected');
        connectionStatus.onclick = function (e) {
            if (e.target.classList.contains('connection-status-disconnected'))
                wsConnect();
            else
                wsClose();
        };

        // default: try to connect
        wsConnect();

    </script>

</body>
</html>
